"""
Clump Finding Problem: Find patterns forming clumps in a string.
     Input: A string Genome, and integers k, L, and t.
     Output: All distinct k-mers forming (L, t)-clumps in Genome.
     
Reverse complement and blur matching aren't considered here.
"""
import urllib2

URL = 'https://stepic.org/media/attachments/lessons/4/clump_finding_data.txt' 
CODE = {'A':0,'C':1,'G':2,'T':3}
KMERS = set()
KMERS_LIST = []


#*************************HASH ALGORITHM*************************#
def code_convert(text, k):
    code_r = {0:'A', 1:'C', 2:'G', 3:'T'}
    seq_r = ''

    while len(seq_r) < k:
        seq_r =  code_r[text % 4] + seq_r
        text  = text // 4
    return seq_r


def pattern_search_hash(seq, k, L, times):
    global KMERS
    pattern = [[] for _ in range(4**k)]
    kmer_value = 0
    for i in range(k):
        kmer_value = kmer_value * 4 + CODE[seq[i]]
    pattern[kmer_value].append(0)
    for i in range(1, len(seq) - k + 1):
        kmer_value = kmer_value % (4**(k-1)) * 4 +  CODE[seq[i + k - 1]]
        pattern[kmer_value].append(i)
#        pattern[reverse_constant - int(reading_frame[::-1])] += 1  ###Convert a string
        
#    max_rep = max(pattern)
    
    for idx in range(len(pattern)):
        if len(pattern[idx]) >= times:
#            print code_convert(idx, k), len(pattern[idx]), pattern[idx]
            pos_list = pattern[idx]
            pos_list.insert(0, 0)
            pos_list.append(len(seq) - k)
            for pos in range(1, len(pos_list) - times):
                if pos_list[pos + times - 1] - pos_list[pos] <= L - k + 1 and \
                    pos_list[pos + times] - pos_list[pos - 1] > L - k + 1:
                    KMERS.add(code_convert(idx, k))
#                    print code_convert(idx, k)
                    break

                                                    
#file = urllib2.urlopen(URL)
#genome = ''.join(ch for ch in file.read() if ch.isalpha())
#genome = 'GCAGACAGCTATCTCCCTGAGCTCATCGTATGCGTAGTGTCAATTTGTACAGCCAAGTCGGAGGTTTAGGCCAAAACTTGGAGGCCTAAACAACCGAAATGTCCGTCGGCCCTGAAGACAGACGTTCCTTCAATGTCAAGGACCGATCAAACGGTCCTCTGCATGACGAATCGGCCTCTCCGCGTTTGGAGTAGATTGAACTGTGATTATCAATATGCTTTTTACGCGACCTCTACGGGCTTGGGCGCAAGAAAACTACGACTCCGTTATTTAATCTACAGATTCTTGTTTTAAATCGAGAAGGTTTCTAGCACCTCCTCGGACCCGACCCATACAACAATAATGATGACCTATTCTGCACGAAATACACAGGGTCCGAGTGTAGTAGCGGCGGAGCGTCTAGTTGGAAACAACCCGCTTTGGCGGAGCTATAACCTCTCGCGATCGACAGATGAGGCATACACCACGTAATCGGTGTTTAGATAATTGACGCACTGGCTTTCTCTTCAATAGCCGTGTTGCAGCGGATGTGGCTTTATGTCGTTTGCGACGCAGTACTAGTTAAGTGCTAGTCATTGCTGTTACCATCCTGGACCCCATGAAAGTCCCTGTCACGAATAGTGGTTGCTAACTAGCAGAGCTATTGTCCAACCCCTGCCTCACGCTTGCCCTCATACAACGTAGTCCATCAGGCACTCTGGCTTTTTGCGTGGTGTCGTCGCAATGGTTTATTGCCTCAGCCTAGTGGGGGAATTCTCCCACGAGATGCCATACTTATCCCATGATAGCATATGGCTCTACGTATCAGAAGTCAGGATGTTGCTCGACGACGAGAGTCTGCAGTGAAAGGCTCAGAGCGAGCATGCAAACAGTGCATATTAGATACCTCGAGGCAGCGATGGGGGATACCCCCACTTCCGCGCATGGATATGAATTTTCTCAGGGATGCAAATGTCAGTCTTAACCACTCGCGCCCCGAACTCGGCGATACCGGTGTTCTGTCGGATAGGCGTATATCCTATCCAGATCGGGTCTCGAGGCTCCTTCCGCAAATTGGTAAATCTCCGGGCCTATAGTGTCCATTCTGAGAGCGTCGTGAGGCGCAGCAGGTGCAAACTTCGAATGCGCAATTCATCACGCCCTGGGAGGTTCGCTATTCGTCAAACTGTAAGCAGCTAGAGAGAAAGATGCACTAGTCGCGTACTCTATCGTAAAAACCATAACAGGGGGCTTGAATCCACGAGATCATTAAGTGGTTCCCGTCGTTCCGGGACACCTTTCAATTGATATAAGATGTGGGACCCGAGCCTCGACGCAGCTTGTAGTAGTGGGAGTCCCAGAAAGTCTGCCTTCAGGATGGTCTCACTGCTTCGGGGTCGTTAGACCAACGTGGCCCTTTCCGCTACCAACCCGGTGAATTGCTAGTTCTACGGTTTGCGCTTAACTTGATTTGAAGTGTTGGACATCTGATCGCATGCATTCCCGTCCTTTACCGATAAGGTCCTAACGTAATTTGCCACGAGCCGGATTTTTGCCCGGAGTTTCTCATGCGTAAGTGAGAAGGGGCGGAGACACAAGGACGAATATGGGAAAAATTTAAAGCTTGTACGCAGTGCGTATCACTCTACGAACATGGCATCAAAGAGACTGATTTGGTGAAATCTCCAAACGTAAAGCTGATACACGTTGGTGTGAAGTCGATCATTCCTGCGAATGCAACTTATAGTCTTTACCGCTGTTGGTAGACTCAGACACATACGATTGATTCTACAGCGAACGTGTCCGGATGGCCCGTAGTGCAACCTATAACGACATTAATAGTTCACCGTCCGCCGAATATTTGTGGGACCCTTTAAGACACGCGATCATCCTGGAAGACACGCGCACGCGTTCGATAGGTAGGAAGGATCGAAGACACGCGACGTAGCAAGACACGCGACACGCGGTATATGCCGGATCTTCAAGACACGCGTCAAAGACACGCGCTGCTAGCAGGGCGTAAGCACAGCACCAAGACACGCGCAAGACACGCGCACGCGCGTGCAGATAGTCAAGACACGCGGTTTATTGAAGATACGTCTACCAAAAGACACGCGACGCGGAAGACACGCGTCAATTGCTCCCTCTGGGGTAGGCGGTGTTTCCAGTCCCACCACTGTTAGGGTGTTTAGCTAAGACACGCGCACGCGGACCAAGGCATTAATCAATGAACTATCTACCAACCCCCAAGACACGCGTAAGAAGACACGCGGATAAAGACACGCGTTTCGTACCAGCAATTCCGCATCAATTTATCGATTTTCATCGAAAGACACGCGCAAAATGCGGAAACAATCTAAAAGACACGCGCAACTTAGACGAGATAAGACACGAAGACACGCGTGAACACGACATGGGAATACTTGTTGGGACTGCCACAAGACACGCGAAGACACGCGAGACACGCGGCGGGGAGTGAGTAGGAAGTACAACCCTCGCCTAGTACTACGCTAATTCAATGCTCGACGGCAGATCAAATGGGCCCCCTTACGATTACTATTACAGGACGCTCAGGCGGTTACTTTACAGGCTTACAGTCAGCCCTCAAAAATAAGTGTGTGGAGAATACGCTGATGCCAAAAAGCGGATGGTTGCCCACCTGCCGAGTCTTATAGGCGCACTCGGTCCTTTTCGAAACGTTATGATGAATGTTATGAGATCTGGGACACATCATTTCGGTGTTCAGAGCATACAAGGCCGCTAAGGCATCAGTGGTTGACTAGTGGATATCCCATTTCGTGCTCCAGTCGGGAGCTATACAGATGGTTACATTCTGGACCCTGGGCTATCTCTGCTACAGGAGTTCATTGATTGATATGATATACATTTTCATAGCTCTATTGGCATTTGAACAGAGTGGCTTAAAGTTGGCGCTCTTCTTTTAGCAACCGCGACATGTAAAAAGAAGGAGTTACCATAAAAGCTGATCAATACATGTGAGTTACCTTCCTGTACAGTAGACATCTGCTGATTCGTCTCGATAATGATTATAGCCGAGCTATGCGATGGTGACAGGAAAGCCTAAGAAGCCTGGATTTCTACCGTATCCCGTCGGTTAGCCCTCCTGTATTTATAGCACGTGTCCCTACCTTACTACCGGCCAAACTGCAAAAGGCCATGAACAAGAGGGTGCTAACCCAGCACCTGCACCTCCCAGCACCTCAGCACCTTGATCGGCACGTGTCGGCACGTGTCGGCACGTGGGTCCTGCACCCAGCACTCGGCACGTGAGCACCTATTAAAGCCCAGCACCTCTATGTGGTTTTGACGAGATTTGGCAATGTCAGGGCGCGACTGGGACCCCATTACCATTCGGCACGTGTCGGCACGTGCGGCACGTGCTGCACCTTAGATCGTCGGCACGTGAGACACAGTCGGCACGTGCACCTTTCGGCACGTTCGGCACGTGGCACGTGTGCCCAGCACCTCACATCGGCACGTGGCATCGGCACGTGAGTCGGCACGTGTATCTGTATTTCGTCGGCACGTGGAAAGTCGGCACGTGGGTCGGCACGTGGTGCACCTAATCCATGACAGGCAAATGAATCGGCACGTGTGCCAGCACCTCCCAGCACCTCCGTTCTCGGCACGTGTGCCATCTCGGGCAAAACGCTTGTGTTCCCTCCCAGTTCGGCACGTGAGTCGGCACGTGGCACGTGTACAAATAGCCATCGGCACGTGAGCTATAGAACTCTTATTCTCCCCAGCACCCCAGCACCTACGCCTACGTATTGACCATCGGCACGTGGGCACGTGAGTTCATCCTGACACCGCAGTGTCAGCCGCTTTTGAGCTTACACCCAAAGAAAAATTGTAATGTCTGACAATTGGCTGCTAGTACCTGTCGACCAGCTAATCGTAGTGCGTTGGTAGACCAGAGCCCGGGCCGAATACCTTGAGCGGCTGCCCACTGGAAGACCTTATCCCGTCGGTACTCCCTAGGTATTCAGCGGGTACTACTCTTGAGGCAAAGGAGTGAACCTGGCCGTAATAGAACCTTAAGTCGGCCGCGCCAATCATGACGTGAACTTAACATAAACTCAACAGCCGAAACCACTGGTCAAACGGTGTAAGCTTCCGACCCTCGGGCCTGATCGTATCCGCGTGGTAGTTAGGTAGTTGAACAACCTCTCAACCTCCGAGATAGTACCGCGAGGTGGGTACTTATGTTATCGCCGACGCCCTATTATGGTTCCTATAATGTGCTCACAACAATGAACGCAGCCAGGCGGTAATAGTGGAGTCACTACACTGGCACCCCCACCCGCATCTGCATCTTGACAGGGGGATTGTAGACGAAATATGCTGGGTATACCCGCATCTTTGTTGTGAACTAGGTACCCGCATCTATCCCGTATCGCGATTTACACCCGCATCTTGCGAAACACTCGAACCACTATCTGATCTACCCGCATCTTTCAGTGCACCCGCATCTGATGTCTCTCAGGGACTGTGTCGGTAAGTTTAACCTCACCCGCATCTTTAACCCGCATCTCCAACCCGCATCTCATTTGGACCCGCACCCGCATCTGCAAACCCGCAACCCGCATCTTCTCAGAATTCACTTGACAAACCCGCATCTAGAGAACTCTCTTGGACCCGCATCTTACACCCGTACCACCCGCATCTCCCGCAACCCGCATCTAGCTTACCCGCATCTTAAAAGGCCGATACATCCAGACCCGCATCTACCGCCTATCATAACCCGCATCTATCAGGGCAACCCGCATCTATCTGGATCTTTCGGGAGGGAGCATTGCGACACCCGCATCTCTGAAGCGAATAGAAGACCCGCATCTAGAGCAGTACCCGCAACCCGCATCTTGTTCTTTACCCGCATCTGACTGTCATGCGACCCTTTCTCAGGTTCCGGCTTAGTCCTTAGATCGGTAGTTGAATATTGAGCTCCAGTCGGAGGTGCTCCGCTACTATTGAAAGCCACACAATGAGGTGTCTTGAAAGAAAGTCCTGGTACCCATACCTGGTTGACATCCTATTCGGCCGAGTCGATTTAGGAGGGGACCGTCGTTCACTTTTTACGCTGCAGAATAATGCGTGCCTACTGCGTCTGCCGAGAAACTTCCCATACTATGGAATTGTGACCGGAGGCCTTAAGCGTTGGGGACGGTTGATTATACTTCACAATGGATACCGGGGAGGCTAAACGTCGAATAGTGGAGAGGAGATTCTAGGCTAGGTCGAAGCTTGCAACGGGGTGCGACATAGTGGAGATCACCCTGCTTAATCCGTGATAGTGGAGATTACCGACCATTATTGTCCAGTCAAGGACTATAGTGGAGAATGAATAGTGGAGAAGTGGAGATCTTAATACGCTTTAATAGTGGAGATGAGACCGCACAACGCGGGCCCGAGCAGATTGTCCTTTTGTCTCTAACTAAATAGTGGAGAGACATAGTGGAGAAACGGCTCGGCCTCCCTCTGAACAAAGGGTAATAGTGGAGAGCAAATAGTGGAGATCGGTTACCAGGGCACATGGTATAGTGATAGTGGAGACAATAGTGGAGAGAGAAGGGGTCACCACGAATAGTGGAGATGCCCGGATAGTGGAGATGATAGTGGAGAAGTGGAATAGTGGAGATGTATCCCATATAGTGGAGAAGAGCAGACTAGACATAAGTTAATCCCCATTTCATAAAGTTAATCCCCGAAGTTAATCCCAAGTTAATCCAGCTGACATAGTGGAGACGAAGTTAATCCGAGATAGTGGAGATAGGTGAACGAGATGCAAAGTTAATCCTTAATCCCTCGGCGTAGCCGCATTAGAAGTTAATCCTTAATCCAAAGTTAAAAGTTAATCCATCCGGTTTTAAAGTTAATCCAATAAGTTAATCCTCTTAGCCCGTAATGTCGCTCAAGTTAATCCTTGCGAAGTTAATCCAATCAGCCCACCAGTAGAGGGCTCCATCGCTAACTTGCTGCTTTCGGGAATCTCTATGAACTTAAGTTAAGTTAATCCAGGCTAGGAAAGTTAATCCCAAAGTTAATCCTATGAGCTATAAGTTAATCCAAGTTAATCCACTGATGGACAGAAGTGCATTCCTAGGCGAAGTTAATCCGGGTGGAAGTTAAAAGTTAATCCACACCGACAAGTTAATCCTGGAGAAGTTAATCCTTAATCCTCTGGACGACATCTGCTCTGTTCGTTGTAATCACTTAGCGCGGCCCAGAGTCTCTTATAGGTTGTGCCGGTGCGTGGCGAATGTTACCAATGTGTCCGATTATAAAGAATGGTTTTGTCCTAATTAGTAGTTTTAATACCGAGTTTAGTGGACCGGGGATCTGGGCTAGCGCCGCTTAACCTGAAATGTGCCGATGGACACCAGACAGAATAATTTGTGGCTAGATCCGCCTGGCCCACAGAAGGACGCAGAGTGCAACAACATTCGTCCTCCCACGTGGCCGGTCTACGAGCGTCCATAATGCTCATGTGCACAACTGCTAAACACAGTGAAGCCCTGGTCCGAGGAACAAGATTCGATTTCCCGTGAACCCATACTGCGGTATATAACTTTTACGTTAGTCCCGTATAAACCATATGCGTAGCTAGAGGCCCACATCTGCGGGATGCCGATCTCGACAACAGAGCCGTCACCCATGGCCTTCTTAGATCCTAAGACAAGTCCATGAAGAGAATAAAACCAACGTCTAGCCTCTCTCGTGGTAAGGAGCCCGCAATGTCATACGGTAACCATGGTTAAGATCGCGGCAATCTCGCTCTACAAAAGCGTACAACCTAGGAAAGAACATGTAGTGTTCATGCACACCTGTCAACCTTGAACAGGTGCGTGGGCGAACTGAATAGGCTCAAAACGTATCGCGCGCTTGTCTTACCTGATAACGCGATGACAAGAGCTAATATAGTCGGCGGTGCTTGGGTGGGAAGCGCACCGTGATCTCACCCTAAGAGCGCGCCCGATTGGATTAGGTCTTCGGATAAACCTGTGCTTCCCTCTCACTTGGCGACATATGAGACTGCTACAGTCCGTAGACACAAAGGAGAATAAGGTGTTGAAGCTCGCCCACTATTACTTGATTCCAAACAAAGCCCCCTGCTAGTATGCTACAGTTTAGGTACAGCGAGTTGGATGAGCGTGCCCTTCAGATATGTAATACAATAGGAAAGGTGTACGTGACTCTCGAGCATGTGGGGCGGCGAGACAAGCGCAGGAGAACTGTCTGATGCCGGTACGTAGGTCACTTTACGACAAACCTGGTGGGAGTGTGGAGACCTGTAACGCTTCGTGTTCCTCTATGCGCAAGACAGGTTGGGTTGCACACAGGTCAGTGAGTACAGCTTTTCGCTATCATAACATTCTGCATATTAGGCACACCTTATCACAAACGCTTTCCCAATGCTCGGACTCATTCTCGTCAAAGCGCTCGTCAAAGTAGCTTGGCTACTCGTCCTCGTCAAAGCAAAGTCTCGTCCTCGTCAAAGACTGGCGATCACATCTACCCTCGTCAAAGATACCATTCAATCTCGTCAAAGGTACTACCAATGAGCTCGTCAAAGTCAAAGCTCTCCTCGTCAAAGCCTCGTCACTCGTCAAAGTAGTCCCGGCTACATGACCGCTCGTAGGTGGTTACCTCGTCAAAGCCCTCGTCAAAGCGTCTCGTCAAAGTCGATTGCTCGTCAAAGGGAACTCGTCAAAGCTAAAGAAACAGGATCATATATGTCGGATCCTGGAACTGGCCGCGCGTTCGATAGTTCTCGTCAAAGCGTCAAAGTCCATCTACCCTACGCGCAATCATCCTCGTCAAAGAGCCTCGTCAAAGAGGCTGGTTTTCGATAGGTTCCCTTCCTGATTGGAGCGGTGCCCAACTCGTCAAAGCGTCAAAGCTCGTCAAAGAGAAAGGGATTCTCTCGTCAAAGTCGGCGCTACAGCCCCAGTGGCTGCCATAACAGTGTTTCTCGTCAAAGCAACCGACTGCACGGTGCTAAATGCGACTGAAATGCCGTGTTGTTTTATAAAGTCGGTAAATGGATTGACTAGCTAGTACGGATGAGAAACTCGTCCCCGTTCAGTTCAGTGTTCAGTCTTGCTCGTTCAGTCTTTAGGTTCAGTCTTTCGCAGGAGCCGCCTGTTCAGTCGGTTCAGTCTTAAAAAGGTCACGTATGGTCGGTTCAGTCGTTCAGTCTTAGCGGAGCCATAGATACTTAGATAAGACGCGGAGGTTAGTTCAGTCTTGCCTCCCTGTTAGAAAGGGGTGGGGCCCGTTCAGTTCAGTCTTAAGTGGAAGGGGTGGGGCTGATGGAGTTCAGTTCAGTCTTAACATCTATCCTAAAGGGTTCAGTCTTTTCAGTCTTCAGTTCAGTCTTTTCAGTCTTGGGAATACATGGAAGTATTACTGTTCAGTCTTACATGGTAGCCCTCCTCGGCAAGGGGTGGGGTTCAGTCTTATGGTTCAGTCTTAAGGTTCAGTCTGTTCAGTCTTGGGGTCTCTGAAGGGGTGGGTAGTGTTCAGTCTTCCAAGTTCAGTCTTCAGTCTTGGTTAAGGGGTGGGTTTGTCATAAGCACGATGAGGGGGTTCAGTCTTGTCTTGGGAGCACGATGAATACTTAGCACGATGAGTAGTTCAGTCTTTAGCACGATGATTTGGTCAAAAGCACGATGACACGATGAGCAGCACGATGAGGGGGTAAGGGGAAGAGCACGATGAGAGCACGATGAGGAAGGGGTGGGAAGAGCACGATGATGGGTTGACCGTGAGCACGATGAAGCAGCACGATGAACTGTCGGAACCTTTGGTCTATCCAGCAGCACGATGAGTTAAGGAGTTGTCAAGTATTAGCACGATGAAGCACGATGAAGCACGATGATTTAAGGTTAAGGAGTTCAGATGACAGCACGATGATAAGCACGATGATTAAGGAGTTTTAAGGAGTTCAACCGCGCCTTAAGGAGTTCACGATGAGTTAAGGAGTTGCCAGCACGATGAAACTTAAGGAGTTTATATGGGTGGCTTAAGACAAGTCTCAGTGGTTAAGGAGTTAGCGGTTAAGGAGTTTTTAAGGAGTTCAGCACGAGCTTAAGGAGTTACGATGACGAGCGTTAAGGAGTTTTAAGGAGTTTCCAAATGGAACAGCGTTAAGGAGTTGGATTCAAGCGGACATTAAGGAGTTGTCAACTCAAAACCCTACACCGCTTAAGGAGTTTTCGCTCTACCGTGGGGATCACCGAAATAGAGCTTAAGGAGTTTTAAGTTAAGGAGTTTAGTTTTAAGGAGTTTTAAGGAGTTTTAAGGAGTTTTAAGGTTAAGGAGTTAAGGAGTTTTTAAGGAGTT'
genome = 'CCGACAGGCTAGTCTATAATCCTGAGGCGTTACCCCAATACCGTTTACCGTGGGATTTGCTACTACAACTCCTGAGCGCTACATGTACGAAACCATGTTATGTAT' 
seq = 'CGGACTCGACAGATGTGAAGAACGACAATGTGAAGACTCGACACGACAGAGTGAAGAGAAGAGGAAACATTGTAA'          
pattern_search_hash(genome, 4, 30, 3)
 
kmer_string = ''
for kmer in KMERS:
    kmer_string += kmer + ' '
print kmer_string
"""
test= 'AAACCAGGTGG'
kmer_value = 0
for i in test:
        kmer_value = kmer_value * 4 + CODE[i]
print kmer_value
"""
        
        