'''
Compare a theoretical spectrum data generated from a peptide and the experimental spectrum
Score counts all the exp_spec data that appears in theo_spec
Repeated data must indicate repeated pattern. Or the data point doesn't count as a match.
'''



import urllib2

URL = 'https://stepic.org/media/attachments/lessons/98/integer_mass_table.txt'
file = urllib2.urlopen(URL)
MASS = {}
for line in file.readlines():
    entry = line.split()
    MASS[entry[0]] = int(entry[1])
 
def cyclospectrum(seq):            
    # O(n) = L ** 2
    # Transform aa sequence --> mass --> spectrum
    total_mass = 0
    for i in range(len(seq)):
        total_mass += MASS[seq[i]]
    spec = [0] * (total_mass + 1)  # Has to assign 0. Cannot construct empty vector
    spec[0] = 1
    spec[total_mass] = 1
    
    for i in range(len(seq)):
        cyc_seq = seq[i : ] + seq[0 : i]
#        print cyc_seq
        mass_j = 0
        for j in range(len(seq)-1):
            mass_j += MASS[cyc_seq[j]]
#            print cyc_seq[j], mass_j
            spec[mass_j] += 1
    
    output = ''
    for i in range(len(spec)):
        if spec[i] != 0:
            output += (str(i) + ' ') * spec[i]

    return output

#print cyclospectrum('LEQN')
#print cyclospectrum('HYNTV')


def calculate_score(theo_seq, exp_seq):
    #O(n) = L ** 2
    exp_seq_list = exp_seq.split(' ')
    theo_seq_list = theo_seq.split(' ')
    
    score = 0
    for value in exp_seq_list:
        if value in theo_seq_list:
            theo_seq_list.remove(value)
            score += 1
    return score
'''
aaseq = 'NQEL'
theo_seq = cyclospectrum(aaseq)
exp_seq = '0 99 113 114 128 227 257 299 355 356 370 371 484'
'''

'''
aaseq = 'WDWLDYTVNGYRSQIVLTTNLWTKPMTRGIQKVAKRTVILIGRDYAASNI'
theo_seq = cyclospectrum(aaseq)
exp_seq = '0 57 57 57 57 71 71 87 87 97 97 99 99 99 99 99 101 101 101 101 101 101 113 113 113 113 113 113 113 113 114 114 114 115 115 128 128 128 131 131 156 156 156 156 156 158 163 163 168 170 170 171 186 186 186 186 186 186 200 200 200 201 202 212 212 212 212 213 213 213 214 215 220 226 227 227 228 230 232 241 241 243 253 255 257 257 257 259 264 270 270 271 271 272 278 283 283 284 285 287 287 298 299 299 299 299 301 313 313 313 314 314 314 314 315 319 324 325 325 326 328 328 329 334 340 340 349 356 358 363 368 369 370 371 371 372 372 376 379 382 383 384 385 385 385 388 398 400 406 411 412 413 413 414 414 414 414 416 426 426 427 427 427 429 433 439 439 445 450 453 454 463 469 470 471 473 477 478 482 483 484 484 484 485 485 485 490 496 498 499 499 500 513 515 515 524 525 526 526 527 527 528 534 534 534 535 540 540 541 542 544 544 549 554 555 556 558 569 570 571 571 577 581 582 583 585 586 589 591 592 595 595 597 598 600 600 611 613 616 626 626 636 638 638 639 640 641 647 648 649 652 654 655 655 657 663 668 669 670 670 671 671 672 676 682 683 684 684 685 686 686 690 696 696 696 697 700 701 701 704 705 709 710 710 712 713 714 720 728 735 739 739 742 746 749 751 753 754 767 767 769 772 777 781 782 783 783 783 784 785 785 786 796 796 797 799 801 802 803 804 811 812 812 814 814 817 818 822 824 824 828 829 834 841 841 842 848 849 852 853 853 859 864 866 867 870 870 870 882 883 883 887 896 898 898 900 905 906 909 909 910 913 913 914 915 916 916 917 917 925 929 935 935 937 939 940 941 941 942 947 953 954 958 960 962 963 966 967 967 967 968 969 971 980 984 985 995 997 998 998 1000 1010 1013 1013 1014 1014 1015 1016 1017 1018 1019 1022 1023 1023 1026 1028 1030 1034 1034 1038 1039 1042 1048 1052 1052 1053 1055 1056 1061 1061 1064 1068 1069 1070 1071 1095 1095 1097 1099 1099 1099 1100 1102 1109 1110 1115 1115 1117 1118 1121 1123 1123 1126 1126 1128 1128 1129 1131 1135 1136 1136 1140 1141 1141 1147 1148 1148 1152 1153 1154 1154 1160 1162 1166 1170 1181 1182 1183 1183 1194 1196 1198 1199 1199 1201 1205 1208 1209 1212 1216 1217 1219 1220 1222 1225 1227 1228 1230 1230 1230 1232 1235 1238 1240 1241 1241 1249 1249 1251 1254 1254 1254 1255 1255 1256 1261 1261 1265 1265 1271 1273 1280 1281 1291 1296 1296 1300 1309 1309 1309 1311 1311 1312 1316 1318 1320 1322 1322 1327 1327 1328 1329 1330 1331 1331 1331 1336 1338 1340 1340 1348 1348 1348 1354 1356 1367 1367 1368 1368 1369 1372 1375 1378 1380 1385 1386 1387 1393 1394 1395 1396 1397 1417 1419 1419 1424 1424 1424 1425 1427 1428 1429 1430 1432 1432 1435 1435 1437 1437 1440 1440 1441 1444 1449 1451 1455 1459 1462 1465 1466 1467 1468 1472 1481 1481 1481 1483 1485 1486 1486 1487 1492 1494 1500 1506 1508 1508 1511 1513 1516 1516 1519 1522 1524 1524 1524 1531 1533 1534 1534 1536 1538 1541 1542 1542 1543 1548 1553 1553 1560 1568 1568 1569 1573 1579 1579 1580 1580 1583 1584 1584 1586 1587 1590 1595 1595 1599 1599 1605 1605 1609 1611 1614 1617 1620 1621 1630 1630 1633 1635 1637 1637 1637 1637 1639 1641 1644 1647 1652 1655 1655 1666 1667 1669 1669 1670 1672 1672 1680 1680 1681 1682 1683 1687 1688 1692 1692 1694 1694 1694 1694 1697 1698 1699 1700 1704 1710 1724 1729 1731 1733 1734 1738 1739 1743 1746 1748 1751 1752 1753 1754 1754 1756 1764 1765 1765 1770 1770 1781 1783 1785 1786 1787 1791 1791 1795 1795 1796 1799 1800 1800 1801 1803 1805 1806 1807 1807 1809 1809 1811 1812 1825 1830 1830 1833 1835 1838 1838 1843 1843 1844 1850 1850 1852 1852 1857 1866 1867 1869 1869 1871 1878 1880 1882 1882 1884 1892 1900 1900 1901 1901 1904 1904 1905 1908 1909 1909 1912 1912 1913 1914 1917 1919 1919 1920 1922 1922 1925 1926 1931 1934 1943 1951 1951 1956 1958 1958 1963 1965 1965 1965 1966 1966 1967 1969 1970 1970 1974 1979 1982 1985 1993 1993 1995 1995 1996 2000 2005 2005 2006 2006 2012 2013 2013 2014 2016 2018 2019 2023 2031 2032 2036 2050 2053 2057 2057 2057 2062 2064 2064 2066 2066 2068 2069 2071 2075 2076 2079 2080 2082 2082 2083 2083 2086 2090 2093 2094 2095 2105 2108 2112 2113 2113 2114 2114 2117 2120 2121 2121 2123 2124 2125 2126 2132 2133 2145 2149 2152 2156 2161 2162 2163 2164 2165 2166 2168 2170 2170 2171 2171 2177 2178 2179 2179 2179 2179 2182 2184 2196 2197 2199 2204 2209 2209 2210 2214 2214 2218 2218 2218 2220 2221 2222 2225 2228 2231 2237 2238 2244 2246 2249 2253 2254 2265 2266 2269 2269 2269 2269 2276 2277 2277 2277 2277 2278 2280 2280 2283 2283 2283 2284 2288 2288 2289 2289 2291 2292 2294 2298 2310 2317 2319 2327 2334 2334 2334 2335 2336 2341 2341 2345 2345 2345 2353 2353 2364 2365 2365 2365 2366 2368 2370 2370 2376 2377 2377 2378 2379 2382 2382 2382 2384 2390 2390 2391 2392 2395 2397 2401 2402 2404 2404 2411 2426 2433 2433 2439 2439 2440 2446 2447 2448 2449 2450 2450 2454 2458 2459 2463 2466 2466 2466 2469 2471 2475 2477 2478 2478 2478 2479 2480 2481 2483 2483 2490 2490 2490 2492 2492 2493 2495 2496 2496 2497 2501 2503 2504 2508 2520 2521 2529 2539 2539 2540 2546 2547 2547 2550 2552 2553 2558 2563 2567 2570 2572 2574 2576 2576 2577 2579 2580 2581 2582 2582 2584 2586 2589 2590 2591 2591 2592 2594 2596 2597 2602 2603 2605 2608 2609 2609 2617 2618 2623 2626 2633 2634 2634 2636 2639 2647 2648 2651 2651 2652 2652 2654 2659 2660 2660 2664 2667 2668 2671 2679 2683 2683 2683 2689 2689 2694 2695 2695 2700 2702 2704 2704 2705 2705 2705 2705 2708 2716 2717 2722 2724 2733 2737 2746 2747 2748 2749 2750 2752 2753 2753 2754 2759 2761 2762 2762 2765 2765 2765 2765 2767 2767 2772 2773 2777 2782 2782 2789 2792 2795 2796 2796 2796 2799 2803 2804 2809 2810 2816 2817 2817 2818 2819 2820 2822 2823 2831 2833 2834 2835 2847 2852 2853 2854 2860 2860 2862 2863 2864 2872 2875 2875 2875 2878 2880 2880 2880 2881 2890 2891 2891 2895 2895 2900 2902 2904 2905 2909 2910 2910 2910 2917 2918 2923 2924 2930 2930 2932 2932 2935 2937 2938 2945 2946 2948 2951 2951 2953 2953 2959 2960 2965 2966 2973 2973 2973 2974 2978 2979 2981 2983 2988 2988 2992 2992 2993 3002 3003 3003 3003 3005 3008 3008 3008 3011 3019 3020 3021 3023 3023 3029 3030 3031 3036 3048 3049 3050 3052 3060 3061 3063 3064 3065 3066 3066 3067 3073 3074 3079 3080 3084 3087 3087 3087 3088 3091 3094 3101 3101 3106 3110 3111 3116 3116 3118 3118 3118 3118 3121 3121 3122 3124 3129 3130 3130 3131 3133 3134 3135 3136 3137 3146 3150 3159 3161 3166 3167 3175 3178 3178 3178 3178 3179 3179 3181 3183 3188 3188 3189 3194 3194 3200 3200 3200 3204 3212 3215 3216 3219 3223 3223 3224 3229 3231 3231 3232 3232 3235 3236 3244 3247 3249 3249 3250 3257 3260 3265 3266 3274 3274 3275 3278 3280 3281 3286 3287 3289 3291 3292 3292 3293 3294 3297 3299 3301 3301 3302 3303 3304 3306 3307 3307 3309 3311 3313 3316 3320 3325 3330 3331 3333 3336 3336 3337 3343 3344 3344 3354 3362 3363 3375 3379 3380 3382 3386 3387 3387 3388 3390 3391 3391 3393 3393 3393 3400 3400 3402 3403 3404 3405 3405 3405 3406 3408 3412 3414 3417 3417 3417 3420 3424 3425 3429 3433 3433 3434 3435 3436 3437 3443 3444 3444 3450 3450 3457 3472 3479 3479 3481 3482 3486 3488 3491 3492 3493 3493 3499 3501 3501 3501 3504 3505 3506 3506 3507 3513 3513 3515 3517 3518 3518 3518 3519 3530 3530 3538 3538 3538 3542 3542 3547 3548 3549 3549 3549 3556 3564 3566 3573 3585 3589 3591 3592 3594 3594 3595 3595 3599 3600 3600 3600 3603 3603 3605 3606 3606 3606 3606 3607 3614 3614 3614 3614 3617 3618 3629 3630 3634 3637 3639 3645 3646 3652 3655 3658 3661 3662 3663 3665 3665 3665 3669 3669 3673 3674 3674 3679 3684 3686 3687 3699 3701 3704 3704 3704 3704 3705 3706 3712 3712 3713 3713 3715 3717 3718 3719 3720 3721 3722 3727 3731 3734 3738 3750 3751 3757 3758 3759 3760 3762 3762 3763 3766 3769 3769 3770 3770 3771 3775 3778 3788 3789 3790 3793 3797 3800 3800 3801 3801 3803 3804 3807 3808 3812 3814 3815 3817 3817 3819 3819 3821 3826 3826 3826 3830 3833 3847 3851 3852 3860 3864 3865 3867 3869 3870 3870 3871 3877 3877 3878 3878 3883 3887 3888 3888 3890 3890 3898 3901 3904 3909 3913 3913 3914 3916 3917 3917 3918 3918 3918 3920 3925 3925 3927 3932 3932 3940 3949 3952 3957 3958 3961 3961 3963 3964 3964 3966 3969 3970 3971 3971 3974 3974 3975 3978 3979 3979 3982 3982 3983 3983 3991 3999 4001 4001 4003 4005 4012 4014 4014 4016 4017 4026 4031 4031 4033 4033 4039 4040 4040 4045 4045 4048 4050 4053 4053 4058 4071 4072 4074 4074 4076 4076 4077 4078 4080 4082 4083 4083 4084 4087 4088 4088 4092 4092 4096 4097 4098 4100 4102 4113 4113 4118 4118 4119 4127 4129 4129 4130 4131 4132 4135 4137 4140 4144 4145 4149 4150 4152 4154 4159 4173 4179 4183 4184 4185 4186 4189 4189 4189 4189 4191 4191 4195 4196 4200 4201 4202 4203 4203 4211 4211 4213 4214 4214 4216 4217 4228 4228 4231 4236 4239 4242 4244 4246 4246 4246 4246 4248 4250 4253 4253 4262 4263 4266 4269 4272 4274 4278 4278 4284 4284 4288 4288 4293 4296 4297 4299 4299 4300 4303 4303 4304 4304 4310 4314 4315 4315 4323 4330 4330 4335 4340 4341 4341 4342 4345 4347 4349 4349 4350 4352 4359 4359 4359 4361 4364 4367 4367 4370 4372 4375 4375 4377 4383 4389 4391 4396 4397 4397 4398 4400 4402 4402 4402 4411 4415 4416 4417 4418 4421 4424 4428 4432 4434 4439 4442 4443 4443 4446 4446 4448 4448 4451 4451 4453 4454 4455 4456 4458 4459 4459 4459 4464 4464 4466 4486 4487 4488 4489 4490 4496 4497 4498 4503 4505 4508 4511 4514 4515 4515 4516 4516 4527 4529 4535 4535 4535 4543 4543 4545 4547 4552 4552 4552 4553 4554 4555 4556 4556 4561 4561 4563 4565 4567 4571 4572 4572 4574 4574 4574 4583 4587 4587 4592 4602 4603 4610 4612 4618 4618 4622 4622 4627 4628 4628 4629 4629 4629 4632 4634 4634 4642 4642 4643 4645 4648 4651 4653 4653 4653 4655 4656 4658 4661 4663 4664 4666 4667 4671 4674 4675 4678 4682 4684 4684 4685 4687 4689 4700 4700 4701 4702 4713 4717 4721 4723 4729 4729 4730 4731 4735 4735 4736 4742 4742 4743 4747 4747 4748 4752 4754 4755 4755 4757 4757 4760 4760 4762 4765 4766 4768 4768 4773 4774 4781 4783 4784 4784 4784 4786 4788 4788 4812 4813 4814 4815 4819 4822 4822 4827 4828 4830 4831 4831 4835 4841 4844 4845 4849 4849 4853 4855 4857 4860 4860 4861 4864 4865 4866 4867 4868 4869 4869 4870 4870 4873 4883 4885 4885 4886 4888 4898 4899 4903 4912 4914 4915 4916 4916 4916 4917 4920 4921 4923 4925 4929 4930 4936 4941 4942 4942 4943 4944 4946 4948 4948 4954 4958 4966 4966 4967 4967 4968 4969 4970 4970 4973 4974 4974 4977 4978 4983 4985 4985 4987 4996 5000 5000 5001 5013 5013 5013 5016 5017 5019 5024 5030 5030 5031 5034 5035 5041 5042 5042 5049 5054 5055 5059 5059 5061 5065 5066 5069 5069 5071 5071 5072 5079 5080 5081 5082 5084 5086 5087 5087 5097 5098 5098 5099 5100 5100 5100 5101 5102 5106 5111 5114 5116 5116 5129 5130 5132 5134 5137 5141 5144 5144 5148 5155 5163 5169 5170 5171 5173 5173 5174 5178 5179 5182 5182 5183 5186 5187 5187 5187 5193 5197 5197 5198 5199 5199 5200 5201 5207 5211 5212 5212 5213 5213 5214 5215 5220 5226 5228 5228 5229 5231 5234 5235 5236 5242 5243 5244 5245 5245 5247 5257 5257 5267 5270 5272 5283 5283 5285 5286 5288 5288 5291 5292 5294 5297 5298 5300 5301 5302 5306 5312 5312 5313 5314 5325 5327 5328 5329 5334 5339 5339 5341 5342 5343 5343 5348 5349 5349 5349 5355 5356 5356 5357 5357 5358 5359 5368 5368 5370 5383 5384 5384 5385 5387 5393 5398 5398 5398 5399 5399 5399 5400 5401 5405 5406 5410 5412 5413 5414 5420 5429 5430 5433 5438 5444 5444 5450 5454 5456 5456 5456 5457 5457 5467 5469 5469 5469 5469 5470 5470 5471 5472 5477 5483 5485 5495 5498 5498 5498 5499 5500 5501 5504 5507 5511 5511 5512 5512 5513 5514 5515 5520 5525 5527 5534 5543 5543 5549 5554 5555 5555 5557 5558 5558 5559 5564 5568 5569 5569 5569 5569 5570 5570 5570 5582 5584 5584 5584 5584 5585 5596 5596 5598 5599 5600 5600 5605 5611 5612 5612 5613 5613 5619 5624 5626 5626 5626 5628 5630 5640 5642 5642 5651 5653 5655 5656 5656 5657 5663 5668 5669 5670 5670 5670 5671 5671 5671 5671 5681 5682 5683 5683 5683 5697 5697 5697 5697 5697 5697 5712 5713 5713 5715 5720 5720 5725 5727 5727 5727 5727 5727 5752 5752 5755 5755 5755 5768 5768 5769 5769 5769 5770 5770 5770 5770 5770 5770 5770 5770 5782 5782 5782 5782 5782 5782 5784 5784 5784 5784 5784 5786 5786 5796 5796 5812 5812 5826 5826 5826 5826 5883'
print calculate_score(theo_seq, exp_seq)
'''

aaseq = 'MAMA'
theo_seq = cyclospectrum(aaseq)
exp_seq = '0 57 71 71 71 104 131 202 202 202 256 333 333 403 404'
print calculate_score(theo_seq, exp_seq)